import{j as A}from"./jsx-runtime.D_zvdyIk.js";import{r as I}from"./index.RH_Wq4ov.js";/**
 * @preserve
 * Kontra.js v10.0.2
 */function D(e,t){let i=Math.sin(t),s=Math.cos(t);return{x:e.x*s-e.y*i,y:e.x*i+e.y*s}}function M(e,t,i){return Math.min(Math.max(e,i),t)}let _=()=>{};function K(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}let S={};function P(e,t){S[e]=S[e]||[],S[e].push(t)}function L(e,...t){(S[e]||[]).map(i=>i(...t))}let d,b,$={get(e,t){return t=="_proxy"?!0:_}};function x(){return b}function N(e,{contextless:t=!1}={}){if(d=document.getElementById(e)||e||document.querySelector("canvas"),t&&(d=d||new Proxy({},$)),!d)throw Error("You must provide a canvas element for the game");return b=d.getContext("2d")||new Proxy({},$),b.imageSmoothingEnabled=!1,L("init"),{canvas:d,context:b}}class R{constructor({spriteSheet:t,frames:i,frameRate:s,loop:h=!0,name:r}){let{width:n,height:a,spacing:l=0,margin:p=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:s,loop:h,name:r,width:n,height:a,spacing:l,margin:p,isStopped:!1,_f:0,_a:0})}clone(){return new R(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:s=this.width,height:h=this.height,context:r=x()}){let n=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+n*this.height+(n*2+1)*this.spacing,this.width,this.height,t,i,s,h)}}function q(){return new R(...arguments)}class f{constructor(t=0,i=0,s={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new f(this.x+t.x,this.y+t.y,this)}subtract(t){return new f(this.x-t.x,this.y-t.y,this)}scale(t){return new f(this.x*t,this.y*t)}normalize(t=this.length()||1){return new f(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,i,s,h){this._c=!0,this._a=t,this._b=i,this._d=s,this._e=h}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?M(this._a,this._d,t):t}set y(t){this._y=this._c?M(this._b,this._e,t):t}}function C(){return new f(...arguments)}class F{constructor(t){return this.init(t)}init(t={}){this.position=C(),this.velocity=C(),this.acceleration=C(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class O extends F{init({width:t=0,height:i=0,context:s=x(),render:h=this.draw,update:r=this.advance,children:n=[],anchor:a={x:0,y:0},opacity:l=1,rotation:p=0,drotation:u=0,ddrotation:g=0,scaleX:m=1,scaleY:w=1,...o}={}){this._c=[],super.init({width:t,height:i,context:s,anchor:a,opacity:l,rotation:p,drotation:u,ddrotation:g,scaleX:m,scaleY:w,...o}),this._di=!0,this._uw(),this.addChild(n),this._rf=h,this._uf=r,P("init",()=>{this.context??=x()})}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=this.width,s=this.height;this.radius&&(i=s=this.radius*2);let h=-i*this.anchor.x,r=-s*this.anchor.y;(h||r)&&t.translate(h,r),this.context.globalAlpha=this.opacity,this._rf(),(h||r)&&t.translate(-h,-r),this.children.map(a=>a.render&&a.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:s=1,_wrot:h=0,_wsx:r=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=n*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=h+this.rotation;let{x:a,y:l}=D({x:this._wx,y:this._wy},h);this._wx=a,this._wy=l,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||_,i._pc()})}removeChild(...t){t.flat().map(i=>{K(this.children,i)&&(i.parent=null,i._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=M(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}let T=class extends O{init({image:t,width:i=t?t.width:void 0,height:s=t?t.height:void 0,...h}={}){super.init({image:t,width:i,height:s,...h})}get animations(){return this._a}set animations(t){let i,s;this._a={};for(i in t)this._a[i]=t[i].clone(),s=s||this._a[i];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}};function U(){return new T(...arguments)}function W(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function z({fps:e=60,clearCanvas:t=!0,update:i=_,render:s,context:h=x(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let n=0,a=1e3/e,l=1/e,p=t?W:_,u,g,m,w,o,E=!0;r||(window.addEventListener("focus",()=>{E=!0}),window.addEventListener("blur",()=>{E=!1})),P("init",()=>{o.context??=x()});function k(){if(g=requestAnimationFrame(k),!!E&&(m=performance.now(),w=m-u,u=m,!(w>1e3))){for(n+=w;n>=a;)L("tick"),o.update(l),n-=a;p(o.context),o.render()}}return o={update:i,render:s,isStopped:!0,context:h,start(){this.isStopped&&(u=performance.now(),this.isStopped=!1,requestAnimationFrame(k))},stop(){this.isStopped=!0,cancelAnimationFrame(g)},_frame:k,set _last(H){u=H}},o}let B={},J={},v={},y={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function X(e=_,t){e._pd&&t.preventDefault(),e(t)}function Q(e){let t=y[e.code],i=B[t];v[t]=!0,X(i,e)}function Z(e){let t=y[e.code],i=J[t];v[t]=!1,X(i,e)}function V(){v={}}function tt(){let e;for(e=0;e<26;e++)y["Key"+String.fromCharCode(e+65)]=String.fromCharCode(e+97);for(e=0;e<10;e++)y["Digit"+e]=y["Numpad"+e]=""+e;window.addEventListener("keydown",Q),window.addEventListener("keyup",Z),window.addEventListener("blur",V)}function it(e){return!![].concat(e).some(t=>v[t])}function et(e){if(+e==e)return e;let t=[],i=e.split(".."),s=+i[0],h=+i[1],r=s;if(s<h)for(;r<=h;r++)t.push(r);else for(;r>=h;r--)t.push(r);return t}let st=class{constructor({image:t,frameWidth:i,frameHeight:s,spacing:h=0,margin:r=0,animations:n}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:s,spacing:h,margin:r},this._f=(t.width-r)/i|0,this.createAnimations(n)}createAnimations(t){let i,s;for(s in t){let{frames:h,frameRate:r,loop:n}=t[s];if(i=[],h==null)throw Error("Animation "+s+" must provide a frames property");[].concat(h).map(a=>{i=i.concat(et(a))}),this.animations[s]=q({spriteSheet:this,frames:i,frameRate:r,loop:n,name:s})}}};function rt(){return new st(...arguments)}let G={init:N,GameLoop:z,initKeys:tt,keyPressed:it,Sprite:U,SpriteSheet:rt};const ht={src:"/_astro/player.CG1KCAaD.png"},{Sprite:nt,keyPressed:c,SpriteSheet:at}=G,ot=(e,t)=>{const i=new Image;i.src=ht.src;const s=at({image:i,frameWidth:28,frameHeight:28,animations:{right:{frames:[0,1,2,3],frameRate:10},left:{frames:[4,5,6,7],frameRate:10},top:{frames:[8,9,10,11],frameRate:10},bottom:{frames:[12,13,14,15],frameRate:10}}});return nt({x:0,y:0,width:40,height:40,animations:s.animations,currentAnimation:s.animations.right,update(){if(!this.animations)return;const r=2;let n=!1,a=this.currentAnimation;c("arrowright")||c("d")?(a=this.animations.right,this.x=Math.min(e-(this.width||0),(this.x||0)+r),n=!0):c("arrowleft")||c("a")?(a=this.animations.left,this.x=Math.max(0,(this.x||0)-r),n=!0):c("arrowup")||c("w")?(a=this.animations.top,this.y=Math.max(0,(this.y||0)-r),n=!0):(c("arrowdown")||c("s"))&&(a=this.animations.bottom,this.y=Math.min(t-(this.height||0),(this.y||0)+r),n=!0),this.currentAnimation!==a&&(this.currentAnimation=a,typeof this.currentAnimation.reset=="function"?this.currentAnimation.reset():"frameIndex"in this.currentAnimation&&(this.currentAnimation.frameIndex=0)),n?this.currentAnimation.update():"frameIndex"in this.currentAnimation&&(this.currentAnimation.frameIndex=0)}})},Y=400,j=400,{init:ct,initKeys:lt,GameLoop:ut}=G,wt=()=>{const e=I.useRef(null);return I.useEffect(()=>{if(!e.current)return;lt();const{canvas:t,context:i}=ct(e.current);t.width=Y,t.height=j;const s=ot(Y,j);ut({update(){s.update()},render(){i.fillStyle="transparent",i.fillRect(0,0,t.width,t.height),s.render()}}).start()},[]),A.jsxs("main",{className:"flex items-center justify-center min-h-full",children:[A.jsxs("p",{className:"absolute top-4 left-4 text-gray-700",children:["Use WASD or arrow keys.",A.jsx("br",{}),"Try to explore the room without leaving its boundaries!"]}),A.jsx("canvas",{ref:e,className:"border-2 border-gray-700 rounded-lg shadow-lg",style:{maxWidth:"100%",height:"auto"}})]})};export{wt as default};
